# Singbox Auto Updater - 项目概览

## 📦 项目信息

**项目名称**: Singbox Auto Updater  
**版本**: 1.0.0  
**作者**: Kimi  
**创建日期**: 2026-01-04  
**许可证**: MIT

## 🎯 项目目标

自动化Singbox代理配置的更新流程，实现：
1. 定期检测订阅服务器更新
2. 自动更新Pro配置
3. 自动生成Air V5.9和V7.8版本
4. 支持云端部署（Zeabur等）

## 🏗️ 技术架构

### 核心组件

```
┌─────────────────────────────────────────────┐
│         Scheduler (定时调度器)               │
│                                             │
│  ┌────────────────────────────────────┐   │
│  │  每6小时执行一次                     │   │
│  └────────────────────────────────────┘   │
└──────────────┬──────────────────────────────┘
               ↓
┌──────────────────────────────────────────────┐
│    Subscription Checker (订阅检查器)          │
│                                              │
│  1. 下载订阅 → 2. 解析 → 3. 对比hash        │
│  4. 如有变化 → 保存新版本                    │
└──────────────┬───────────────────────────────┘
               ↓ (有更新时)
┌──────────────────────────────────────────────┐
│         Updater (Pro配置更新器)               │
│                                              │
│  1. 解析订阅服务器                           │
│  2. 按地区分类 (HK/SG/US/JP)                │
│  3. 更新4个服务器组                          │
│  4. 保留自定义服务器                         │
└──────────────┬───────────────────────────────┘
               ↓
┌──────────────────────────────────────────────┐
│      Generator (Air版本生成器)                │
│                                              │
│  Air V5.9: 简化 + 保留自定义                 │
│  Air V7.8: 完整 - 自定义服务器               │
└──────────────┬───────────────────────────────┘
               ↓
┌──────────────────────────────────────────────┐
│             生成三个配置文件                   │
│                                              │
│  - Pro Updated (完整版)                      │
│  - Air V5.9 (个人简化版)                     │
│  - Air V7.8 (朋友分享版)                     │
└──────────────────────────────────────────────┘
```

### 技术栈

- **语言**: Python 3.12
- **依赖**: schedule (定时任务)
- **部署**: Docker + Zeabur
- **存储**: 文件系统（可扩展至云存储）

## 📁 项目结构详解

```
singbox-auto-updater/
│
├── 配置相关
│   ├── config/
│   │   ├── base_configs/          # 基础配置
│   │   │   └── Singbox_Pro_V5_9.json
│   │   └── settings.json          # 应用配置
│   └── Dockerfile                 # 容器配置
│
├── 数据目录
│   ├── subscription_history/      # 订阅历史（版本控制）
│   ├── outputs/                   # 生成的配置文件
│   └── logs/                      # 日志文件
│
├── 源代码
│   ├── src/
│   │   ├── subscription_checker.py  # 订阅检查
│   │   ├── updater.py              # Pro更新
│   │   ├── generator.py            # Air生成
│   │   └── scheduler.py            # 定时任务
│   └── main.py                     # 主程序
│
└── 文档
    ├── README.md                   # 主文档
    ├── QUICKSTART.md              # 快速开始
    ├── CONFIG_GUIDE.md            # 配置指南
    └── DEPLOYMENT.md              # 部署指南
```

## 🔄 工作流程

### 1. 启动阶段
```python
main.py 
  → 加载配置 
  → 初始化组件 
  → 设置定时任务
  → 执行首次检查
```

### 2. 定时检查
```python
每6小时 (可配置)
  → SubscriptionChecker.check_for_updates()
    → 下载订阅
    → 计算hash
    → 与历史版本对比
    → 如有变化 → 触发更新
```

### 3. 更新流程
```python
if 检测到更新:
  # 步骤1: 更新Pro
  updater.update_pro_config()
    → 解析订阅服务器
    → 更新HKonly/SGonly/USonly/AllServer
    → 保留自定义服务器
    → 生成 Pro_Updated.json
  
  # 步骤2: 生成Air
  generator.generate_air_versions()
    → 生成 Air_V5_9.json (个人)
    → 生成 Air_V7_8.json (分享)
```

## 🎨 设计理念

### 1. Skills驱动

严格遵循两个skills的定义：
- **singbox-updater**: 更新逻辑
- **singbox-air-generator**: 生成逻辑

### 2. 模块化设计

每个组件职责单一：
- Checker: 只负责检查
- Updater: 只负责更新Pro
- Generator: 只负责生成Air

### 3. 可扩展性

- 支持自定义通知方式
- 支持多种部署方式
- 易于添加新功能

### 4. 数据安全

- 版本控制（所有历史都保存）
- 不修改原始配置
- 日志完整记录

## 📊 关键指标

### 性能指标
- **启动时间**: < 5秒
- **检查耗时**: < 30秒
- **更新耗时**: < 10秒
- **内存占用**: < 100MB

### 可靠性
- **错误处理**: 完整的try-catch
- **日志记录**: 所有关键步骤
- **版本恢复**: 支持查看历史

## 🔧 可配置项

### 核心配置
- 订阅URL
- 检查间隔（小时）
- 日志级别
- 输出目录

### 扩展配置
- 自定义服务器列表
- 通知方式
- 存储位置

## 🚀 部署方式

### 1. 本地运行
```bash
python main.py --mode schedule
```

### 2. Docker运行
```bash
docker run -d singbox-auto-updater
```

### 3. Zeabur部署
- GitHub连接
- 自动构建
- 自动部署

## 📈 未来计划

### v1.1 计划
- [ ] Web界面查看配置
- [ ] 支持多个订阅源
- [ ] 自动推送到云存储
- [ ] 微信/Telegram通知

### v1.2 计划
- [ ] 配置对比工具
- [ ] 性能统计dashboard
- [ ] 支持更多Air版本
- [ ] API接口

## 🤝 贡献指南

欢迎贡献代码或提出建议：

1. Fork项目
2. 创建特性分支
3. 提交更改
4. 发起Pull Request

## 📝 更新日志

### v1.0.0 (2026-01-04)
- ✅ 初始版本发布
- ✅ 支持自动更新Pro配置
- ✅ 支持自动生成Air V5.9/V7.8
- ✅ 支持Zeabur部署
- ✅ 完整文档

## 📄 许可证

MIT License - 自由使用、修改和分发

## 🙏 致谢

- 基于 singbox-updater skill
- 基于 singbox-air-generator skill
- 感谢Zeabur提供云服务支持

---

**维护者**: Kimi  
**项目主页**: (待添加)  
**问题反馈**: GitHub Issues
